"use strict";var intervalShopeePay=null,intervalShopeePayCheckStatus=null,shopee_payment_id=null,ajaxCheckStatus=null,zalo_date=null,renew_qr_loading=!1,checking_status=!1,intervalZaloPay=null,CartPayment={purchaseProcessingHtml:"Đang xử lý <span>•</span>\n<span>•</span>\n<span>•</span>",vnpayPurchase:function(e){let a=$('textarea[name="info_vat"]').val(),t=$(e).html();$.ajax({url:"/cart/purchase",type:"POST",data:{payment_method:"vnpay",info_vat:a,name:$('input[name="name"]').val(),email:$('input[name="email"]').val(),phone:$('input[name="phone"]').val(),address:$('textarea[name="address"]').val()},beforeSend:function(){$(e).html(CartPayment.purchaseProcessingHtml).addClass("btn-processing").prop("disabled",!0)}}).done((a=>{console.log(a),a.success?window.location.replace(a.payment_link):(notifiMessage(a.message,"danger"),$(e).html(t).removeClass("btn-processing").prop("disabled",!1))})).fail(((a,n)=>{notifiMessage(formatErrorAjaxMessage(a,n),"danger"),$(e).html(t).removeClass("btn-processing").prop("disabled",!1)}))},intcardPurchase:function(e){let a=$('textarea[name="info_vat"]').val(),t=$(e).html();$.ajax({url:"/cart/purchase",type:"POST",data:{payment_method:"vnpay_int",info_vat:a,name:$('input[name="name"]').val(),email:$('input[name="email"]').val(),phone:$('input[name="phone"]').val(),address:$('textarea[name="address"]').val()},beforeSend:function(){$(e).html(CartPayment.purchaseProcessingHtml).addClass("btn-processing").prop("disabled",!0)}}).done((a=>{console.log(a),a.success?window.location.replace(a.payment_link):(notifiMessage(a.message,"danger"),$(e).html(t).removeClass("btn-processing").prop("disabled",!1))})).fail(((a,n)=>{notifiMessage(formatErrorAjaxMessage(a,n),"danger"),$(e).html(t).removeClass("btn-processing").prop("disabled",!1)}))},momoPurchase:function(e){let a=$('textarea[name="info_vat"]').val(),t=$(e).html();$.ajax({url:"/cart/purchase",type:"POST",data:{payment_method:"momo",info_vat:a,name:$('input[name="name"]').val(),email:$('input[name="email"]').val(),phone:$('input[name="phone"]').val(),address:$('textarea[name="address"]').val()},beforeSend:function(){$(e).html(CartPayment.purchaseProcessingHtml).addClass("btn-processing").prop("disabled",!0)}}).done((a=>{console.log(a),a.success?location.href=a.payment_link:($(e).html(t).removeClass("btn-processing").prop("disabled",!1),notifiMessage(a.message,"danger"))})).fail(((a,n)=>{notifiMessage(formatErrorAjaxMessage(a,n),"danger"),$(e).html(t).removeClass("btn-processing").prop("disabled",!1)}))},zaloPurchase:function(e){let a=$('textarea[name="info_vat"]').val(),t=$(e).html();$.ajax({url:"/cart/purchase",type:"POST",data:{payment_method:"zalo",info_vat:a,name:$('input[name="name"]').val(),email:$('input[name="email"]').val(),phone:$('input[name="phone"]').val(),address:$('textarea[name="address"]').val()},beforeSend:function(){$(e).html(CartPayment.purchaseProcessingHtml).addClass("btn-processing").prop("disabled",!0)}}).done((a=>{a.success?location.href=a.payment_link:($(e).html(t).removeClass("btn-processing").prop("disabled",!1),notifiMessage(a.message,"danger"))})).fail(((a,n)=>{notifiMessage(formatErrorAjaxMessage(a,n),"danger"),$(e).html(t).removeClass("btn-processing").prop("disabled",!1)}))},shopeePayPurchase:function(e){let a=$('textarea[name="shopeepay_info_vat"]').val();ajaxCheckStatus=null;let t=$(e).html();$.ajax({url:"/cart/purchase",type:"POST",data:{payment_method:"shopeepay",info_vat:a,name:$('input[name="name"]').val(),email:$('input[name="email"]').val(),phone:$('input[name="phone"]').val(),address:$('textarea[name="address"]').val()},beforeSend:function(){$(e).html(CartPayment.purchaseProcessingHtml).addClass("btn-processing").prop("disabled",!0)}}).done((a=>{a.success?a.popup?($(".modal-shopee-payment").find("#qrcode").attr("src",a.qr_url),$(".modal-shopee-payment").find(".price_shopeepay").text(a.amount),shopee_payment_id=a.shopee_payment_id,null!=intervalShopeePayCheckStatus&&null!=intervalShopeePayCheckStatus||(intervalShopeePayCheckStatus=setInterval((function(){null!=shopee_payment_id?null==ajaxCheckStatus&&(ajaxCheckStatus=$.ajax({url:"/cart/shopeepay-tranction-check",type:"POST",data:{shopee_payment_id:shopee_payment_id}}).done((e=>{e.success&&e.redirect_status?(window.location.href=e.url_success,null!=intervalShopeePayCheckStatus&&null!=intervalShopeePayCheckStatus&&clearInterval(intervalShopeePayCheckStatus),ajaxCheckStatus=null):ajaxCheckStatus=null})).fail((e=>{ajaxCheckStatus=null}))):null!=intervalShopeePayCheckStatus&&null!=intervalShopeePayCheckStatus&&clearInterval(intervalShopeePayCheckStatus)}),5e3)),$(".count-down-shopeepay").html(a.expiry_time+":00"),intervalShopeePay=setInterval((function(){var e=$(".count-down-shopeepay").text().split(":"),a=parseInt(e[0],10),t=parseInt(e[1],10);(a=--t<0?--a:a)<0&&(null!=intervalShopeePay&&null!=intervalShopeePay&&(clearInterval(intervalShopeePay),$("#Cart_Button_ThanhtoanShopeePay").html("Tiến hành trả tiền").removeClass("btn-processing").prop("disabled",!1)),null!=intervalShopeePayCheckStatus&&null!=intervalShopeePayCheckStatus&&clearInterval(intervalShopeePayCheckStatus),$(".modal-shopee-payment").modal("hide")),a=a<10?"0"+a:a,t=(t=t<0?59:t)<10?"0"+t:t,$(".count-down-shopeepay").html(a+":"+t)}),1e3),$(".modal-shopee-payment").modal("show")):location.href=a.payment_link:($(e).html(t).removeClass("btn-processing").prop("disabled",!1),notifiMessage(a.message,"danger"))})).fail(((a,n)=>{notifiMessage(formatErrorAjaxMessage(a,n),"danger"),$(e).html(t).removeClass("btn-processing").prop("disabled",!1)}))},renewQRZalo:function(e){renew_qr_loading||(renew_qr_loading=!0,$(".un-renew").addClass("hide"),$(".renew-loading").removeClass("hide"),$.ajax({url:"/cart/renew-qr/zalo",type:"get"}).done((e=>{e.success?($("#CartViewJS").html(e.cart_html),renderrecommentCourseSlick(),CountDownTimer(e.zalo_expired_at),renew_qr_loading=!1):(notifiMessage(e.message,"danger"),$(".un-renew").removeClass("hide"),$(".renew-loading").addClass("hide"),renew_qr_loading=!1)})).fail((e=>{$(".un-renew").removeClass("hide"),$(".renew-loading").addClass("hide"),renew_qr_loading=!1})))},applyCoupon:function(e){let a=$(e).attr("data-course");if(!modal_loading){modal_loading=!0;let t=$(e).html();"undefined"!=typeof cart_order_id?$.ajax({url:"/cart/apply-coupon",type:"POST",data:{course:a,coupon:$(".coupon-input").val(),cart_order_id:cart_order_id},beforeSend:function(){$(e).html('<div class="lds-ring"><div></div><div></div><div></div><div></div></div>')}}).done((a=>{a.success?($(".button-select-voucher.cus-disabled").html("Sử dụng"),$(".button-select-voucher.cus-disabled").removeClass("cus-disabled"),$(".box-voucher-show-text").html('<i class="far fa-badge-percent mr-2"></i> Áp dụng mã giảm giá <span class="text-success fw-700">'+$(".coupon-input").val()+"</span>"),$(".box-voucher-show .box-voucher-show-text").html("Đang sử dụng mã giảm giá "+$(".coupon-input").val()),$(".box-voucher-show .btn-voucher").html("Thay đổi"),$(".modal-voucher").modal("hide"),$(".box-voucher-show img").addClass("hide"),$(e).html("Áp dụng"),modal_loading=!1,a.has_vou_cou?($(".price-voucou.hide").removeClass("hide"),$(".value-voucou").html(a.value_vou_cou)):($(".price-voucou").addClass("hide"),$(".value-voucou").html(0)),$(".cart_order-value").html(a.cart_order_total)):(notifiMessage(a.message,"danger"),modal_loading=!1,$(e).html(t))})).fail(((a,n)=>{notifiMessage(formatErrorAjaxMessage(a,n),"danger"),$(e).html(t),modal_loading=!1})):$.ajax({url:"/cart/"+$(".coupon-input").val()+"/get-coupon",data:{course:a},type:"GET",beforeSend:function(){$(e).html('<div class="lds-ring"><div></div><div></div><div></div><div></div></div>')}}).done((a=>{if(a.success){$(".box-voucher-show-text").html('<i class="far fa-badge-percent mr-2"></i> Áp dụng mã giảm giá <span class="text-success fw-700">'+$(".coupon-input").val()+"</span>"),$(".box-voucher-show .box-voucher-show-text").html("Đang sử dụng mã giảm giá "+$(".coupon-input").val()),$(".box-voucher-show .btn-voucher").html("Thay đổi"),$(".button-select-voucher.cus-disabled").removeClass("cus-disabled"),$(".modal-voucher").modal("hide"),$(".box-voucher-show img").addClass("hide"),$(e).html("Áp dụng"),modal_loading=!1,$('input[name="voucher_id"]').val(""),$('input[name="coupon_id"]').val(a.coupon_id);let t=parseInt(course.sale_price)-parseInt(a.coupon_value);$(".sale-price-display-js").html(number_format(t>0?t:0)+"đ")}else notifiMessage(a.message,"danger"),modal_loading=!1,$(e).html(t)})).fail(((a,n)=>{notifiMessage(formatErrorAjaxMessage(a,n),"danger"),$(e).html(t),modal_loading=!1}))}},checkStatusOrderZalo:function(e){"zalo"==$('input[name="payment_method"]').val()&&(checking_status||(checking_status=!0,$.ajax({url:"/cart/check-status/zalo",type:"get"}).done((e=>{e.success&&(void 0!==e.href&&(location.href=e.href),void 0!==e.cart_html&&($("#CartViewJS").html(e.cart_html),renderrecommentCourseSlick(),CountDownTimer(e.zalo_expired_at))),checking_status=!1})).fail((e=>{checking_status=!1}))))}};intervalZaloPay=setInterval(CartPayment.checkStatusOrderZalo,5e3);
