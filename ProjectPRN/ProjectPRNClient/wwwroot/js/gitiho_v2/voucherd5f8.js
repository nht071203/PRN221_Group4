var modal_loading=!1;if(void 0===had_voucher)var had_voucher=!1;var Voucher={showModalSelectVoucher:function(e){let o=$(e).attr("data-course");if(!modal_loading){modal_loading=!0;let t=$(e).html();if(had_voucher)return void setTimeout((function(){$(".modal-voucher").modal("show"),modal_loading=!1,$(e).html(t)}),400);let a={};""!==o&&(a.course=o),$.ajax({url:"/get-my-discount",data:a,method:"get"}).done((o=>{o.success?($(".modal-voucher .modal-voucher-content").html(o.html),$(".modal-voucher").modal("show"),modal_loading=!1,had_voucher=!0,$(e).html(t)):(notifiMessage(o.message,"danger"),modal_loading=!1,$(e).html(t))})).fail((o=>{notifiMessage("Lỗi phát sinh. Vui lòng thử lại sau.","danger"),modal_loading=!1,$(e).html(t)}))}},selectVoucher:function(e,o){if(!modal_loading){modal_loading=!0;let t=$(e).html();if($(e).html('<div class="lds-ring"><div></div><div></div><div></div><div></div></div>'),"undefined"!=typeof cart_order_id){let a=null;a=$(e).hasClass("cus-disabled")?"remove":"change",$.ajax({url:"/loyalty/voucher/"+o+"/add-voucher-to-order/"+cart_order_id+"/"+a,method:"get"}).done((o=>{o.success?($(e).hasClass("cus-disabled")?($(".button-select-voucher.cus-disabled").html("Sử dụng"),$(".button-select-voucher.cus-disabled").removeClass("cus-disabled"),modal_loading=!1,$(".box-voucher-show img").addClass("hide"),$(".box-voucher-show .box-voucher-show-text").html($(".list-voucher-text").html()),$(".box-voucher-show .btn-voucher").html("Sử dụng")):($(".button-select-voucher.cus-disabled").html("Sử dụng"),$(".button-select-voucher.cus-disabled").removeClass("cus-disabled"),$(e).addClass("cus-disabled"),$(e).html("Đã chọn"),modal_loading=!1,$(".box-voucher-show img.hide").removeClass("hide"),$(".box-voucher-show .box-voucher-show-text").html($(e).parents(".voucher-item").find(".voucher-item-text").html()),$(".box-voucher-show .btn-voucher").html("Thay đổi"),$(".modal-voucher").modal("hide")),o.has_vou_cou?($(".price-voucou.hide").removeClass("hide"),$(".value-voucou").html(o.value_vou_cou)):($(".price-voucou").addClass("hide"),$(".value-voucou").html(0)),$(".cart_order-value").html(o.cart_order_total)):(notifiMessage(o.message,"danger"),modal_loading=!1,$(e).html(t))})).fail((o=>{notifiMessage("Lỗi phát sinh. Vui lòng thử lại sau.","danger"),modal_loading=!1,$(e).html(t)}))}else setTimeout((function(){if($(e).hasClass("cus-disabled")){$(".button-select-voucher.cus-disabled").html("Sử dụng"),$(".button-select-voucher.cus-disabled").removeClass("cus-disabled"),modal_loading=!1,$(".box-voucher-show img").addClass("hide"),$(".box-voucher-show-text").html('<i class="far fa-badge-percent mr-2"></i> Mã giảm giá'),$(".box-voucher-show .box-voucher-show-text").html($(".list-voucher-text").html()),$(".box-voucher-show .btn-voucher").html("Sử dụng"),$('input[name="voucher_id"]').val("");let e=$(".form-register .cou-price p").attr("data-price-old"),o=$(".sale-price-display-js").attr("data-price-old");console.log($(".sale-price-display-js")),console.log(o),$(".sale-price-display-js").html(number_format(o)+"đ"),$(".form-register .cou-price p").html(number_format(e)+"đ")}else{$(".button-select-voucher.cus-disabled").html("Sử dụng"),$(".button-select-voucher.cus-disabled").removeClass("cus-disabled"),$(e).addClass("cus-disabled"),$(e).html("Đã chọn"),modal_loading=!1,$(".box-voucher-show img.hide").removeClass("hide"),$(".box-voucher-show-text").html('<i class="far fa-badge-percent mr-2"></i> Áp dụng '+$(e).parents(".voucher-item").find(".voucher-item-text").html()),$(".box-voucher-show .box-voucher-show-text").html($(e).parents(".voucher-item").find(".voucher-item-text").html()),$(".box-voucher-show .btn-voucher").html("Thay đổi"),$(".modal-voucher").modal("hide"),$('input[name="coupon_id"]').val(""),$('input[name="voucher_id"]').val(o);let t=parseInt($(".sale-price-display-js").attr("data-price-old"))-parseInt($(e).parents(".voucher-item").find(".voucher-item-text").attr("data-price-value"));$(".sale-price-display-js").html(number_format(t>0?t:0)+"đ"),$(".form-register .cou-price p").html(number_format(t>0?t:0)+"đ")}}),400)}}};function number_format(e,o,t,a){for(var l=(e*=1).toFixed(o||0).toString().split("."),s=[],d=l[0].length;d>0;d-=3)s.unshift(l[0].substring(Math.max(0,d-3),d));return l[0]=s.join(a||","),l.join(t||".")}
