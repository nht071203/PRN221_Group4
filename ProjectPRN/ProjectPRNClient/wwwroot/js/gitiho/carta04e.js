var Cart={isAdding:!1,addToCart:function(e,t,a){if(Cart.isAdding)return;Cart.isAdding=!0;let n=$(e).html();$(e).html('<div class="lds-ring my-auto mr-2 white"><div></div><div></div><div></div><div></div></div>'+n),$.ajax({url:"/cart/add",method:"POST",data:{product_id:t,product_model:a,voucher_id:$('input[name="voucher_id"]').val(),coupon_id:$('input[name="coupon_id"]').val()}}).done((t=>{t.success?(Cart.isAdding=!1,$(e).html(n),location.href=t.href):(Cart.isAdding=!1,$(e).html(n))})).fail((t=>{Cart.isAdding=!1,$(e).html(n)}))}};function addAllCartItemUpsale(e){let t=[];course_popups.forEach((e=>{t.push(e.id)})),$.ajax({method:"POST",url:"/cart/adds",data:{course_ids:t,qty:"1"}}).done((function(e){e.success&&($(".add-cart-item-upsale").html("Đã thêm vào giỏ hàng"),$.notify({message:"Đã thêm tất cả khóa học đánh giá cao vào giỏ hàng."},{type:"success"}))})).fail((function(e){}))}function addCartItemUpsale(e,t){let a=course_popups.find((e=>e.id===t));$.ajax({method:"POST",url:"/cart/add",data:{id:a.id,name:a.cou_title,price:a.sale_price,qty:"1"}}).done((function(t){t.success&&($(e).html("Đã thêm vào giỏ hàng"),$.notify({message:"Đã thêm khóa học "+a.cou_title+" đánh giá cao vào giỏ hàng."},{type:"success"}))})).fail((function(e){}))}function loadItems(){$.ajax({method:"GET",url:"/api/cart/list-cart"}).done((function(e){if(e.success){let t="";$("#addCartLocation").length>0&&(e.data.forEach((e=>{t+=`<li class="cart-item cart-course">\n                        <div class="cart-item-label">\n                            <span class="cart-item-name">${e.name}</span>\n                            <span class="delete-item-cart" onclick="deleteItem(this,${e.id})"><i class="fa fa-trash"></i> Xóa</span>\n                        </div>\n                        <span class="cart-item-price"><strong>${format_curency(e.price)}</strong> VNĐ</span>\n                    </li>`})),$("#addCartLocation").append(t)),loadCartDetails()}})).fail((function(e){$.notify({message:e.responseJSON.message},{type:"danger"})}))}function loadCartDetails(){$.ajax({method:"GET",url:"/cart/details"}).done((function(e){e.success&&$(".total-price").html("<strong>"+format_curency(e.data.total)+"</strong> VNĐ")})).fail((function(e){$.notify({message:e.responseJSON.message},{type:"danger"})}))}function deleteItem(e,t){$.ajax({method:"DELETE",url:"/cart/"+t}).done((function(t){t.success&&($(e).parents(".cart-course").remove(),loadCartDetails(),$("#addConditionLocation").length>0&&t.condition&&($(".cart-condition").remove(),$(".input-add-condition").removeClass("hide")),$.notify({message:"Đã xóa khóa học khỏi giỏ hàng."},{type:"warning"}))})).fail((function(e){$.notify({message:e.responseJSON.message},{type:"danger"})}))}function deleteCondition(){$.ajax({method:"DELETE",url:"/cart/conditions"}).done((function(e){e.success&&($(".input-add-condition").removeClass("hide"),$("#cart_item_"+e.data.order).find(".cart-item-price").css("text-decoration","none"),$("#cart_item_"+e.data.order).find(".cart-item-promo").remove(),loadCartDetails(),$.notify({message:"Đã xóa mã giảm giá."},{type:"warning"}))})).fail((function(e){$.notify({message:e.responseJSON.message},{type:"danger"})}))}function addCondition(){$.ajax({method:"POST",url:"/cart/conditions",data:{name:$(".cart-condition-input").val()}}).done((function(e){if(e.success){let t="";$("#cart_item_"+e.data.order).length>0&&($("#cart_item_"+e.data.order).find(".cart-item-price").css("text-decoration","line-through"),t+=`<div class="cart-item-promo">\n                            <span style="display: block;"><strong>${format_curency(e.data.price_value)} VNĐ</strong></span>\n                            <span style="display: block;font-size: 13px">(sử dụng mã <strong style="color: #d81c5c">${e.data.name}</strong>)\n                            <span class="delete-item-cart" style="display: inline-block" onclick="deleteCondition()">Xóa</span>\n                            </span>\n                        </div>`,$("#cart_item_"+e.data.order).append(t)),$(".input-add-condition").addClass("hide"),loadCartDetails(),$.notify({message:"Đã thêm mã giảm giá "+$(".cart-condition-input").val()+"."},{type:"success"})}})).fail((function(e){$.notify({message:e.responseJSON.message},{type:"danger"})}))}function format_curency(e){return e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}function ChangeToSlug(e){let t;return t=e.toLowerCase(),t=t.replace(/á|à|ả|ạ|ã|ă|ắ|ằ|ẳ|ẵ|ặ|â|ấ|ầ|ẩ|ẫ|ậ/gi,"a"),t=t.replace(/é|è|ẻ|ẽ|ẹ|ê|ế|ề|ể|ễ|ệ/gi,"e"),t=t.replace(/i|í|ì|ỉ|ĩ|ị/gi,"i"),t=t.replace(/ó|ò|ỏ|õ|ọ|ô|ố|ồ|ổ|ỗ|ộ|ơ|ớ|ờ|ở|ỡ|ợ/gi,"o"),t=t.replace(/ú|ù|ủ|ũ|ụ|ư|ứ|ừ|ử|ữ|ự/gi,"u"),t=t.replace(/ý|ỳ|ỷ|ỹ|ỵ/gi,"y"),t=t.replace(/đ/gi,"d"),t=t.replace(/\`|\~|\!|\@|\#|\||\$|\%|\^|\&|\*|\(|\)|\+|\=|\,|\.|\/|\?|\>|\<|\'|\"|\:|\;|_/gi,""),t=t.replace(/ /gi,"-"),t=t.replace(/\-\-\-\-\-/gi,"-"),t=t.replace(/\-\-\-\-/gi,"-"),t=t.replace(/\-\-\-/gi,"-"),t=t.replace(/\-\-/gi,"-"),t="@"+t+"@",t=t.replace(/\@\-|\-\@|\@/gi,""),t}function selectPayment(e,t){$.ajax({url:"/cart/change_payment_method/"+cart_order_id,data:{payment_method:t},method:"post"}).done((a=>{a.success&&($(".box-custom.box-left").removeClass("active"),$(e).addClass("active"),$('input[name="payment_method"]').val(t),$(".payment-method--label").html(a.payment_method_label),$(".payment-method--note").html(a.payment_method_note),$(".payment-method--show").removeClass("active"),$(".payment-method--show-"+t).addClass("active"),$(".payment-method--btn").removeClass("active"),$(".payment-method--btn-"+t).addClass("active"),$("#CartViewJS").html(a.cart_html),renderrecommentCourseSlick(),CountDownTimer(a.zalo_expired_at))})).fail((e=>{}))}function addCouponToCart(e){$.ajax({method:"POST",url:"/cart/conditions",data:{name:e}}).done((function(e){e.success?($("#CartViewJS").html(e.cart_html),renderrecommentCourseSlick(),$(".pay-amount").html(e.amount)):notifiMessage(e.message,"danger")})).fail((function(e){notifiMessage(e.message,"danger")}))}$("#addCartItem").on("click",(function(){from_upsale?from_upsale=1:from_upsale=null,$.ajax({method:"POST",url:"/cart/add",data:{id:course.id,name:course.cou_title,price:course.sale_price,qty:"1",from_upsale:from_upsale}}).done((function(e){e.success&&$("#showPopupCart").modal("show")})).fail((function(e){}))}));
